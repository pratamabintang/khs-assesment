<app-form title="Profile" desc="Ubah data akun & alamat perusahaan kamu">
  <div class="mx-auto w-full max-w-txl px-4 sm:px-6">
    @if (errorMsg()) {
      <div
        class="mt-4 rounded-xl border border-orange-200 bg-orange-50 px-4 py-3 text-sm text-orange-700"
      >
        {{ errorMsg() }}
      </div>
    }

    @if (successMsg()) {
      <div
        class="mt-4 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700"
      >
        {{ successMsg() }}
      </div>
    }

    <form class="mt-6 space-y-5 md:col-span-12" [formGroup]="form" (ngSubmit)="save()">
      <div class="rounded-2xl border border-slate-200 bg-white p-5">
        <div class="mb-4 flex items-center justify-between">
          <div>
            <div class="text-sm font-semibold text-slate-900">Data Akun</div>
            <div class="mt-0.5 text-xs text-slate-500">Nama dan nomor HP.</div>
          </div>
        </div>

        <div class="grid gap-4 sm:grid-cols-2">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Nama</label>
            <input
              type="text"
              maxlength="64"
              placeholder="Nama perusahaan / nama akun"
              formControlName="nama"
              class="w-full rounded-xl border px-4 py-3 text-sm outline-none transition focus:ring-2"
              [ngClass]="{
                'border-orange-500 focus:border-orange-500 focus:ring-orange-500/20':
                  isInvalid(nama),
                'border-slate-300 focus:border-indigo-500 focus:ring-indigo-500/20':
                  !isInvalid(nama),
              }"
            />
            @if (isInvalid(nama)) {
              <p class="mt-1 text-xs text-orange-600">
                @if (nama.hasError('required')) {
                  Nama wajib diisi.
                } @else {
                  Nama maksimal 64 karakter.
                }
              </p>
            }
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">No. HP</label>
            <input
              type="tel"
              maxlength="16"
              placeholder="+6281234567890"
              formControlName="phoneNumber"
              class="w-full rounded-xl border px-4 py-3 text-sm outline-none transition focus:ring-2"
              [ngClass]="{
                'border-orange-500 focus:border-orange-500 focus:ring-orange-500/20':
                  isInvalid(phoneNumber),
                'border-slate-300 focus:border-indigo-500 focus:ring-indigo-500/20':
                  !isInvalid(phoneNumber),
              }"
            />
            @if (isInvalid(phoneNumber)) {
              <p class="mt-1 text-xs text-orange-600">{{ phoneError }}</p>
            }
          </div>
        </div>
      </div>

      <div class="rounded-2xl border border-slate-200 bg-white p-5">
        <div class="mb-4">
          <div class="text-sm font-semibold text-slate-900">Alamat</div>
          <div class="mt-0.5 text-xs text-slate-500">Daerah dan alamat lengkap.</div>
          <div class="mt-2 text-xs text-slate-500">
            Jika kamu mengubah salah satu dropdown daerah, semua dropdown daerah + alamat lengkap
            wajib diisi.
          </div>
        </div>

        <app-region-selector
          [provinceCtrl]="provinceId"
          [regencyCtrl]="regencyId"
          [districtCtrl]="districtId"
          [villageCtrl]="villageId"
        ></app-region-selector>

        @if (form.touched && form.errors && regionEdited()) {
          <div class="mt-2 space-y-1 text-xs text-orange-600">
            @if (form.errors['provinceRequired']) {
              <div>Provinsi wajib dipilih.</div>
            }
            @if (form.errors['regencyRequired']) {
              <div>Kota/Kabupaten wajib dipilih.</div>
            }
            @if (form.errors['districtRequired']) {
              <div>Kecamatan wajib dipilih.</div>
            }
            @if (form.errors['villageRequired']) {
              <div>Kelurahan/Desa wajib dipilih.</div>
            }
          </div>
        }

        <div class="mt-4">
          <label class="block text-sm font-medium text-slate-700 mb-1">Alamat Lengkap</label>
          <input
            type="text"
            maxlength="64"
            placeholder="Jalan, nomor, RT/RW, detail lainnya"
            formControlName="fullAddress"
            class="w-full rounded-xl border px-4 py-3 text-sm outline-none transition focus:ring-2"
            [ngClass]="{
              'border-orange-500 focus:border-orange-500 focus:ring-orange-500/20': addressError,
              'border-slate-300 focus:border-indigo-500 focus:ring-indigo-500/20': !addressError,
            }"
          />
          @if (addressError) {
            <p class="mt-1 text-xs text-orange-600">{{ addressError }}</p>
          }
        </div>
      </div>

      <div class="rounded-2xl border border-slate-200 bg-white p-4 md:sticky md:top-6">
        <div class="flex gap-3">
          <button
            type="submit"
            class="w-full rounded-xl bg-gradient-to-r from-indigo-600 to-violet-600 py-3 text-sm font-semibold text-white shadow-lg shadow-indigo-600/20 transition hover:brightness-110 active:brightness-95 disabled:opacity-60 disabled:cursor-not-allowed"
            [disabled]="loading()"
          >
            Simpan
          </button>
        </div>
      </div>
    </form>
  </div>
</app-form>
